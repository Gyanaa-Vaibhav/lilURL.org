name: CI Main
on:
  push:
    branches-ignore:
      - main
  workflow_dispatch:
jobs:

  Build_Image:
    runs-on: [self-hosted, CI]
    steps:
      - name: Pull Code
        uses: actions/checkout@v4

      - name: Build Image
        run: docker compose -f docker-compose-test.yml --env-file=/env/lilUrl/.env build

  Linter:
    runs-on: [self-hosted, CI]
    needs: Build_Image
    steps:
      - name: Start Containers
        run: docker compose -f docker-compose-test.yml --env-file=/env/lilUrl/.env up -d

      - name: Run Linter
        run: docker exec -i lilUrl_backend_test sh -c "npm run lint"

#  Test:
#    runs-on: [self-hosted, CI]
#    needs: Linter
#    steps:
#      - name: Run Test
#        run: docker exec -i lilUrl_backend_test sh -c "npm run test"

  Clean_Up:
    runs-on: [self-hosted, CI]
    needs: Linter
    steps:
      - name: Stop Containers
        if: always()
        run: docker compose -f docker-compose-test.yml --env-file=/env/lilUrl/.env down